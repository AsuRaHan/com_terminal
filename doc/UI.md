# UI — Пользовательский интерфейс

Модуль `ui/` отвечает за создание и управление интерфейсом приложения COMTerminal. Построен на основе Windows API с использованием паттерна разделения ответственности.

## Компоненты

### MainWindow
Главное окно приложения. Содержит логику управления состоянием окна, обработку сообщений Windows и логирование.

**Основные методы:**
- `Create(int nCmdShow)` – создание и отображение окна, возвращает `true` при успехе
- `Handle() const noexcept` – получить HWND окна

**Логирование:**
- Поддерживает 4 типа логов: `Rx` (приём), `Tx` (отправка), `System` (система), `Error` (ошибки)
- Логи выводятся в RichEdit-элемент с цветовым кодированием
- Использует виртуальный буфер логирования (`LogVirtualizer`) для большого объёма данных

**Обэффектирование окна:**
- Регистрация класса окна
- Обработка WM-сообщений
- Управление минимальным размером окна

---

### WindowBuilder
Построитель интерфейса. Отвечает за создание всех элементов управления (кнопки, комбобоксы, поля ввода и т.д.).

**Основные методы:**
- `CreateStatusBar()` – создание строки состояния
- `CreateControls()` – создание всех элементов управления окна
- `FillConnectionDefaults()` – заполнение значений по умолчанию для подключения

**Создаёмые элементы:**
- список доступных портов (ComboBox)
- выбор скорости передачи (ComboBox)
- выбор параметров передачи (ComboBox для битов, чётности, стоповых битов)
- RichEdit для отображения лога
- поле ввода данных
- кнопки управления (открыть, закрыть, отправить)

---

### WindowLayout
Управление расположением элементов при изменении размера окна. Обеспечивает адаптивный интерфейс.

**Основные методы:**
- `ResizeChildren() const` – пересчёт размеров и позиций дочерних элементов
- `ApplyMinTrackSize(MINMAXINFO* minMaxInfo)` – установка минимального размера окна

**Анкеровка элементов:**
- Элементы управления приспосабливаются к новому размеру окна
- RichEdit растягивается во все стороны
- Кнопки остаются замещены в углах

---

### WindowActions
Обработчик пользовательских действий и взаимодействия с серийным портом.

**Основные методы:**
- `RefreshPorts()` – обновление списка доступных портов
- `OpenSelectedPort()` – открытие выбранного порта с параметрами из интерфейса
- `ClosePort()` – закрытие активного порта
- `SendInputData()` – отправка данных из поля ввода в порт
- `HandleSerialData(const std::vector<uint8_t>& bytes)` – обработка данных, полученных из порта

**Формирование параметров:**
- `BuildPortSettingsFromUi(bool* ok)` – сборка структуры `PortSettings` из значений интерфейса
- `FormatIncoming(const std::vector<uint8_t>& bytes)` – форматирование входящих данных для отображения

---

## Архитектура

```
MainWindow
    ├── WindowBuilder  (создание элементов)
    ├── WindowLayout   (управление расположением)
    └── WindowActions  (обработка действий)
```

**Paттерн:**
- `MainWindow` является агрегатором и хранит всё состояние окна
- `WindowBuilder`, `WindowLayout`, `WindowActions` – друзья `MainWindow`, имеют доступ к `private` членам
- Разделение логики на специализированные классы упрощает поддержку и тестирование

---

## Примечания

- Интерфейс использует Windows API (HWND, ComboBox, RichEdit и т.д.)
- Сообщения окна обрабатываются через паттерн callback с `WndProcSetup` и `WndProcThunk`
- Логирование поддерживает большой объём данных благодаря использованию виртуального буфера
- При отправке и получении данных через последовательный порт логи обновляются автоматически

---

*См. также: [SerialPort](SerialPort.md), [LogVirtualizer](LogVirtualizer.md).*
